import React, { useState, useEffect } from "https://esm.sh/react@18";
import ReactDOM from "https://esm.sh/react-dom@18";
import confetti from "https://esm.sh/canvas-confetti";

const CATEGORIES = {
  maison: "bg-violet-100 text-violet-800",
  enfants: "bg-blue-100 text-blue-800",
  admin: "bg-indigo-100 text-indigo-800",
};

const DEFAULT_TASKS = [
  { id: 1, title: "Salle de bain", category: "maison", freq: 7, lastDone: null },
  { id: 2, title: "Cuisine", category: "maison", freq: 3, lastDone: null },
  { id: 3, title: "Lessive", category: "maison", freq: 2, lastDone: null },
  { id: 4, title: "Sacs Ã©cole", category: "enfants", freq: 1, lastDone: null },
];

function daysSince(date) {
  if (!date) return Infinity;
  return Math.floor((Date.now() - new Date(date)) / 86400000);
}

function App() {
  const [tasks, setTasks] = useState(() => JSON.parse(localStorage.getItem("tasks")) || DEFAULT_TASKS);
  const [events, setEvents] = useState(() => JSON.parse(localStorage.getItem("events")) || []);
  const [page, setPage] = useState("home");

  useEffect(() => localStorage.setItem("tasks", JSON.stringify(tasks)), [tasks]);
  useEffect(() => localStorage.setItem("events", JSON.stringify(events)), [events]);

  function completeTask(id) {
    setTasks(t => t.map(task => task.id === id ? { ...task, lastDone: new Date().toISOString() } : task));
    confetti({ particleCount: 80, spread: 90, origin: { y: 0.7 } });
  }

  const todayTasks = tasks.filter(t => daysSince(t.lastDone) >= t.freq);

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-200 to-violet-200 p-4">
      <div className="max-w-md mx-auto space-y-4">
        <header className="text-center">
          <h1 className="text-2xl font-bold text-violet-800">Maison Â· Organisation</h1>
          <p className="text-sm opacity-70">{new Date().toLocaleDateString()}</p>
        </header>

        {page === "home" && (
          <div className="space-y-3">
            <h2 className="font-semibold">Ã€ faire aujourd'hui</h2>
            {todayTasks.length === 0 && <p className="opacity-60">Rien d'urgent ğŸ’™</p>}
            {todayTasks.map(t => (
              <div key={t.id} className={`p-3 rounded-xl shadow bg-white flex justify-between items-center ${CATEGORIES[t.category]}`}>
                <span>{t.title}</span>
                <button onClick={() => completeTask(t.id)} className="px-3 py-1 bg-violet-600 text-white rounded-full">âœ”</button>
              </div>
            ))}
          </div>
        )}

        {page === "agenda" && (
          <div className="space-y-3">
            <h2 className="font-semibold">Agenda</h2>
            <button onClick={() => {
              const title = prompt("Titre du RDV");
              const date = prompt("Date (YYYY-MM-DD)");
              if (title && date) setEvents(e => [...e, { id: Date.now(), title, date }]);
            }} className="w-full p-2 bg-blue-600 text-white rounded-xl">+ Ajouter un RDV</button>
            {events.map(ev => (
              <div key={ev.id} className="p-3 bg-white rounded-xl shadow">
                <div className="font-semibold">{ev.title}</div>
                <div className="text-sm opacity-70">{ev.date}</div>
              </div>
            ))}
          </div>
        )}

        <nav className="fixed bottom-4 left-4 right-4 bg-white rounded-full shadow flex justify-around p-2">
          <button onClick={() => setPage("home")} className="px-4 py-2">ğŸ </button>
          <button onClick={() => setPage("agenda")} className="px-4 py-2">ğŸ“…</button>
        </nav>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  
